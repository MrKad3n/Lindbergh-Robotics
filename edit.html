<!DOCTYPE html>
<html lang="en">
    <head>
		<title>Lindbergh Robotics</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="keywords" content="Robotics, Lindbergh, FTC, First Tech Challenge, Robotics Club, Flybots, STEM, Engineering, Technology, Highschool Robotics">
		<meta name="description" content="Lindbergh Robotics is a high school robotics club that builds robots for the First Tech Challenge (FTC) competition, and does outreach to promote STEM education.">
        <link rel="icon" type="image/x-icon" href="images/robot.png">
        <link rel="stylesheet" type="text/css" href="style.css">
	</head>
    <body>
		<header>
			<a href="index.html"><img src="images/logo.png" alt="Lindbergh Robotics Logo" height="70"></a>
            <nav>
			<a href="index.html">Home</a>
            <a href="member.html">Members</a>
            <a href="projects.html">Current Projects</a>
            <a href="finances.html">Finances</a>
		    </nav>
		</header>
		<main>
			<script>
			  (function(){
			    // guard: require lr_officerAuth in sessionStorage to view this page
			    try {
			      var tok = sessionStorage.getItem('lr_officerAuth');
			      if (!tok) { window.location.replace('officer.html'); }
			    } catch (e) { console.warn('sessionStorage access failed', e); }
			  })();
			</script>
			<div style="display:flex; justify-content:flex-end; gap:8px; margin-bottom:8px;">
			  <button id="logout-btn" type="button">Logout</button>
			</div>
			<div class="edit-container">
				<div class="edit-actions" style="margin-bottom:12px;">
					<button id="add-project" type="button">Add Project</button>
					<button id="add-member" type="button">Add Member</button>
					<button id="add-finance" type="button">Add Finance Item</button>
					<a href="projects.html" target="_blank"><button type="button">View Page</button></a>
				</div>
				<div id="forms-root">
				<!-- Projects Edit -->
				<div>
					<h2>Edit Projects Page</h2>
					<form class="edit-form" data-page="projects" data-index="2">
						<input type="file" id="project1-image" name="image" accept="image/*">
						<br>
						<img id="project1-preview" src="images/ftc.png" alt="project preview" style="max-height:120px; display:block; margin-top:6px;">
						<br>
						<label for="cost1">Cost:</label>
						<input type="text" id="cost1" name="cost" value="$1000">
						<label for="description1">Description:</label>
						<textarea class="project-description" id="description1" name="description">Our Augmented Reality Cart project aims to create an interactive experience for users by integrating augmented reality (AR) technology with a mobile robot platform.</textarea>
						<button type="submit">Save Changes</button>
					</form>
				</div>

				<!-- Members Edit -->
				<div>
					<h2>Edit Members Page</h2>
					<form class="edit-form" data-page="members" data-index="0">
						<label for="member1">Member 1:</label>
						<input type="text" id="member1" name="name" value="John Doe">
						<input type="file" id="member1-image" name="image" accept="image/*">
						<br>
						<img id="member1-preview" src="images/robot.png" alt="member preview" style="max-height:120px; display:block; margin-top:6px;">
						<br>
						<label for="role1">Role:</label>
						<input type="text" id="role1" name="role" value="Driver">
						<label for="bio1">Bio:</label>
						<textarea class="member-bio" id="bio1" name="bio">John is a senior at Lindbergh High School and has been a member of the robotics team for three years.</textarea>
						<button type="submit">Save Changes</button>
					</form>
				</div>

				<!--Finances Edit -->
				<div>
					<h2>Edit Finances Page</h2>
					<form class="edit-form" data-page="finances" data-index="0">
						<h3>Finances - Items</h3>
						<p>Only enter the item name, total needed, amount covered so far, description, and an optional image. The charts are computed from all items.</p>
						<div id="additional-finance-items">
						  <!-- dynamically added finance rows shown here -->
						</div>
						<button type="submit">Save Changes</button>
					</form>
				</div>

			</div>
				



		</main>
		<script>
		  (function(){
		    // Finances edit form handling (client-side persistence using localStorage)
		    var form = document.querySelector('form.edit-form[data-page="finances"]');
		    if (!form) return;

		    // preview image handling for FTC image
		    var ftcImageInput = document.getElementById('ftc-image');
		    var ftcPreview = document.getElementById('ftc-image-preview');
		    if (ftcImageInput && ftcPreview) {
		      ftcImageInput.addEventListener('change', function(ev){
		        var f = ev.target.files && ev.target.files[0];
		        if (!f) return;
		        var reader = new FileReader();
		        reader.onload = function(e){ ftcPreview.src = e.target.result; ftcPreview.style.display = 'block'; };
		        reader.readAsDataURL(f);
		      });
		    }

						// load saved data if present (we only use otherItems here)
						var saved = null;
						try { saved = JSON.parse(localStorage.getItem('finances_data') || 'null'); } catch(e) { saved = null; }

		    // additional finance items container
		    var additionalRoot = document.getElementById('additional-finance-items');
						function renderAdditional(items){
							additionalRoot.innerHTML = '';
							(items || []).forEach(function(it, idx){
								var row = document.createElement('div');
								row.className = 'finance-item-row';
								// labeled inputs in requested order: Name, Total needed, Have so far, Description, Image
								row.innerHTML = '<label>Name:</label> <input type="text" class="fin-name" placeholder="Item name" value="'+(it.name||'')+'"> <br>'
									+ '<label>Total needed ($):</label> <input type="number" class="fin-total" placeholder="Total needed" value="'+(it.totalNeeded||0)+'"> <br>'
									+ '<label>Have so far ($):</label> <input type="number" class="fin-have" placeholder="Have so far" value="'+(it.haveSoFar||0)+'"> <br>'
									+ '<label>Description:</label><br><textarea class="fin-desc" placeholder="Description">'+(it.description||'')+'</textarea><br>'
									+ '<label>Image:</label> <input type="file" class="fin-image" accept="image/*"> '
									+ '<img class="fin-image-preview" style="max-height:60px; display:'+(it.imageData? 'inline-block':'none')+'; margin-left:6px;" src="'+(it.imageData||'')+'"> <br>'
									+ '<button type="button" class="remove-finance">Remove</button>';
								additionalRoot.appendChild(row);

								// wire image preview handling
								(function(r, item){
									var fileInput = r.querySelector('.fin-image');
									var preview = r.querySelector('.fin-image-preview');
									if (fileInput) {
										fileInput.addEventListener('change', function(ev){
											var f = ev.target.files && ev.target.files[0];
											if (!f) return;
											var reader = new FileReader();
											reader.onload = function(e){ preview.src = e.target.result; preview.style.display = 'inline-block'; };
											reader.readAsDataURL(f);
										});
									}
								})(row, it);

								row.querySelector('.remove-finance').addEventListener('click', function(){
									items.splice(idx,1); renderAdditional(items);
								});
							});
						}

		    // if saved has otherItems, render them
		    var otherItems = (saved && saved.otherItems) ? saved.otherItems.slice() : [];
		    renderAdditional(otherItems);

				// wire Add Finance action (button in actions bar) and a global event
				var addFinanceBtn = document.getElementById('add-finance');
						function addFinanceItem() {
							otherItems.push({ name: 'New Item', description: '', imageData: null, totalNeeded: 0, haveSoFar: 0 });
							renderAdditional(otherItems);
						}
				if (addFinanceBtn) {
					addFinanceBtn.addEventListener('click', addFinanceItem);
				}
				// global event so the central script can dispatch it
				document.addEventListener('add-finance-clicked', function(){ addFinanceItem(); });


						form.addEventListener('submit', function(ev){
							ev.preventDefault();
							// Only collect the additional finance items and save them
							try {
								var rows = additionalRoot.querySelectorAll('.finance-item-row');
								var items = [];
								rows.forEach(function(r){
									var name = (r.querySelector('.fin-name')||{}).value || '';
									var desc = (r.querySelector('.fin-desc')||{}).value || '';
									var total = Number((r.querySelector('.fin-total')||{}).value) || 0;
									var have = Number((r.querySelector('.fin-have')||{}).value) || 0;
									var imgEl = r.querySelector('.fin-image-preview');
									var imgData = (imgEl && imgEl.src && imgEl.src.indexOf('data:')===0) ? imgEl.src : (imgEl && imgEl.src && imgEl.src.indexOf('http')===0 ? imgEl.src : null);
									items.push({ name: name, description: desc, imageData: imgData, totalNeeded: total, haveSoFar: have });
								});
								var data = { otherItems: items };
								try { localStorage.setItem('finances_data', JSON.stringify(data)); alert('Finances saved locally. To apply changes to the live page, open finances.html (it reads from localStorage).'); }
								catch (e) { console.error('Failed to save finances_data', e); alert('Save failed: localStorage not available'); }
							} catch (e) {
								console.error('Collecting finance items failed', e);
								alert('Save failed');
							}
						});

		  })();
		</script>
		<footer>
			<p>&copy; 2025 Lindbergh Robotics</p>
			<p>Website by Kaden Cruts</p>
		</footer>
			<script src="script.js"></script>
			<script>
			  (function(){
			    var btn = document.getElementById('logout-btn');
			    if (!btn) return;
			    btn.addEventListener('click', function(){
			      try { sessionStorage.removeItem('lr_officerAuth'); } catch(e){}
			      window.location.href = 'officer.html';
			    });
			  })();
			</script>
		</body>
	</html>