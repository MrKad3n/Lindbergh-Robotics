<!DOCTYPE html>
<html lang="en">
    <head>
		<title>Lindbergh Robotics</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="keywords" content="Robotics, Lindbergh, FTC, First Tech Challenge, Robotics Club, Flybots, STEM, Engineering, Technology, Highschool Robotics">
		<meta name="description" content="Lindbergh Robotics is a high school robotics club that builds robots for the First Tech Challenge (FTC) competition, and does outreach to promote STEM education.">
        <link rel="icon" type="image/x-icon" href="images/robot.png">
        <link rel="stylesheet" type="text/css" href="style.css">
	</head>
    <body>
		<header>
			<a href="index.html"><img src="images/logo.png" alt="Lindbergh Robotics Logo" height="70"></a>
            <nav>
			<a href="index.html">Home</a>
            <a href="member.html">Members</a>
            <a href="projects.html">Current Projects</a>
            <a href="finances.html">Finances</a>
		    </nav>
		</header>
		<main>
			<script>
			  (function(){
			    // guard: require lr_officerAuth in sessionStorage to view this page
			    try {
			      var tok = sessionStorage.getItem('lr_officerAuth');
			      if (!tok) { window.location.replace('officer.html'); }
			    } catch (e) { console.warn('sessionStorage access failed', e); }
			  })();
			</script>
			<div style="display:flex; justify-content:flex-end; gap:8px; margin-bottom:8px;">
			  <button id="logout-btn" type="button">Logout</button>
			</div>
			<div class="edit-container">
				<div class="edit-actions" style="margin-bottom:12px;">
					<button id="add-project" type="button">Add Project</button>
					<button id="add-member" type="button">Add Member</button>
					<button id="add-finance" type="button">Add Finance Item</button>
					<a href="projects.html" target="_blank"><button type="button">View Page</button></a>
				</div>
				<div id="forms-root">
				<!-- Projects Edit -->
				<div>
					<h2>Edit Projects Page</h2>
					<form class="edit-form" data-page="projects" data-index="2">
						<input type="file" id="project1-image" name="image" accept="image/*">
						<br>
						<img id="project1-preview" src="images/ftc.png" alt="project preview" style="max-height:120px; display:block; margin-top:6px;">
						<br>
						<label for="cost1">Cost:</label>
						<input type="text" id="cost1" name="cost" value="$1000">
						<label for="description1">Description:</label>
						<textarea class="project-description" id="description1" name="description">Our Augmented Reality Cart project aims to create an interactive experience for users by integrating augmented reality (AR) technology with a mobile robot platform.</textarea>
						<button type="submit">Save Changes</button>
					</form>
				</div>

				<!-- Members Edit -->
				<div>
					<h2>Edit Members Page</h2>
					<form class="edit-form" data-page="members" data-index="0">
						<label for="member1">Member 1:</label>
						<input type="text" id="member1" name="name" value="John Doe">
						<input type="file" id="member1-image" name="image" accept="image/*">
						<br>
						<img id="member1-preview" src="images/robot.png" alt="member preview" style="max-height:120px; display:block; margin-top:6px;">
						<br>
						<label for="role1">Role:</label>
						<input type="text" id="role1" name="role" value="Driver">
						<label for="bio1">Bio:</label>
						<textarea class="member-bio" id="bio1" name="bio">John is a senior at Lindbergh High School and has been a member of the robotics team for three years.</textarea>
						<button type="submit">Save Changes</button>
					</form>
				</div>

				<!--Finances Edit -->
				<div>
					<h2>Edit Finances Page</h2>
					<form class="edit-form" data-page="finances" data-index="0">
						<!-- Overview numbers -->
						<label for="budget">Current Budget:</label>
						<input type="text" id="budget" name="budget" value="$5000">
						<label for="totalExpenses">Total Expenses:</label>
						<input type="text" id="totalExpenses" name="totalExpenses" value="$2000">
						<label for="remaining">Remaining Budget:</label>
						<input type="text" id="remaining" name="remaining" value="$3000">
						<hr>
						<!-- Cost breakdown (pie chart) - three slices as on the page -->
						<h3>Cost Breakdown (pie chart)</h3>
						<div class="chart-slices">
							<div>
								<label for="slice1-label">Slice 1 Label:</label>
								<input type="text" id="slice1-label" name="slice1Label" value="FTC">
								<label for="slice1-value">Slice 1 Value:</label>
								<input type="number" id="slice1-value" name="slice1Value" value="1500">
							</div>
							<div>
								<label for="slice2-label">Slice 2 Label:</label>
								<input type="text" id="slice2-label" name="slice2Label" value="Outreach">
								<label for="slice2-value">Slice 2 Value:</label>
								<input type="number" id="slice2-value" name="slice2Value" value="500">
							</div>
							<div>
								<label for="slice3-label">Slice 3 Label:</label>
								<input type="text" id="slice3-label" name="slice3Label" value="go kart game">
								<label for="slice3-value">Slice 3 Value:</label>
								<input type="number" id="slice3-value" name="slice3Value" value="1000">
							</div>
						</div>
						<hr>
						<!-- Covered vs Remaining pie -->
						<h3>Budget Coverage</h3>
						<label for="covered-value">Covered Amount:</label>
						<input type="number" id="covered-value" name="coveredValue" value="2000">
						<label for="coverage-remaining">Remaining Amount:</label>
						<input type="number" id="coverage-remaining" name="coverageRemaining" value="3000">
						<hr>
						<!-- FTC Project block (image, progress, details) -->
						<h3>Finance Project: First Tech Challenge</h3>
						<label for="ftc-title">Title:</label>
						<input type="text" id="ftc-title" name="ftcTitle" value="First Tech Challenge">
						<label for="ftc-image">Image (file):</label>
						<input type="file" id="ftc-image" name="ftcImage" accept="image/*">
						<br>
						<img id="ftc-image-preview" src="images/ftc.png" alt="FTC preview" style="max-height:120px; display:block; margin-top:6px;">
						<label for="ftc-progress">Progress % (display text inside bar):</label>
						<input type="number" id="ftc-progress" name="ftcProgress" value="80" min="0" max="100">
						<label for="ftc-details">Details text (dropdown content):</label>
						<textarea id="ftc-details" name="ftcDetails">The FTC team consists of multiple sub teams that work on different aspects of the robot and competition. The main sub teams are:</textarea>
						<hr>
						<!-- Footer-specific finance items -->
						<h3>Footer / Contact</h3>
						<label for="donate-contact">Donate/Sponsor contact (email):</label>
						<input type="email" id="donate-contact" name="donateContact" value="sponsor@example.com">
						<label for="insta-link">Instagram URL:</label>
						<input type="text" id="insta-link" name="instagramUrl" value="https://www.instagram.com/lhs_flybots/">
						<hr>
						<h3>Additional Finance Items</h3>
						<div id="additional-finance-items">
						  <!-- dynamically added finance rows shown here -->
						</div>
						<p><small>Use "Add Finance Item" above to add arbitrary labeled finance items (for display on the finances page).</small></p>
						<hr>
						<button type="submit">Save Changes</button>
					</form>
				</div>

			</div>
				



		</main>
		<script>
		  (function(){
		    // Finances edit form handling (client-side persistence using localStorage)
		    var form = document.querySelector('form.edit-form[data-page="finances"]');
		    if (!form) return;

		    // preview image handling for FTC image
		    var ftcImageInput = document.getElementById('ftc-image');
		    var ftcPreview = document.getElementById('ftc-image-preview');
		    if (ftcImageInput && ftcPreview) {
		      ftcImageInput.addEventListener('change', function(ev){
		        var f = ev.target.files && ev.target.files[0];
		        if (!f) return;
		        var reader = new FileReader();
		        reader.onload = function(e){ ftcPreview.src = e.target.result; ftcPreview.style.display = 'block'; };
		        reader.readAsDataURL(f);
		      });
		    }

		    // load saved data if present
		    var saved = null;
		    try { saved = JSON.parse(localStorage.getItem('finances_data') || 'null'); } catch(e) { saved = null; }
		    if (saved) {
		      // populate fields
		      document.getElementById('budget').value = saved.budget || '';
		      document.getElementById('totalExpenses').value = saved.totalExpenses || '';
		      document.getElementById('remaining').value = saved.remaining || '';
		      document.getElementById('slice1-label').value = saved.slice1Label || 'FTC';
		      document.getElementById('slice1-value').value = saved.slice1Value || 1500;
		      document.getElementById('slice2-label').value = saved.slice2Label || 'Outreach';
		      document.getElementById('slice2-value').value = saved.slice2Value || 500;
		      document.getElementById('slice3-label').value = saved.slice3Label || 'go kart game';
		      document.getElementById('slice3-value').value = saved.slice3Value || 1000;
		      document.getElementById('covered-value').value = saved.coveredValue || 2000;
		      document.getElementById('coverage-remaining').value = saved.coverageRemaining || 3000;
		      document.getElementById('ftc-title').value = saved.ftcTitle || 'First Tech Challenge';
		      document.getElementById('ftc-progress').value = saved.ftcProgress || 80;
		      document.getElementById('ftc-details').value = saved.ftcDetails || document.getElementById('ftc-details').value;
		      if (saved.ftcImageData) { ftcPreview.src = saved.ftcImageData; ftcPreview.style.display='block'; }
		      document.getElementById('donate-contact').value = saved.donateContact || 'sponsor@example.com';
		      document.getElementById('insta-link').value = saved.instagramUrl || 'https://www.instagram.com/lhs_flybots/';
		    }

		    // additional finance items container
		    var additionalRoot = document.getElementById('additional-finance-items');
		    function renderAdditional(items){
		      additionalRoot.innerHTML = '';
		      (items || []).forEach(function(it, idx){
		        var row = document.createElement('div');
		        row.className = 'finance-item-row';
		        row.innerHTML = '<input type="text" class="fin-label" placeholder="Label" value="'+(it.label||'')+'"> '
		          + '<input type="number" class="fin-value" placeholder="Value" value="'+(it.value||0)+'"> '
		          + '<button type="button" class="remove-finance">Remove</button>';
		        additionalRoot.appendChild(row);
		        row.querySelector('.remove-finance').addEventListener('click', function(){
		          items.splice(idx,1); renderAdditional(items);
		        });
		      });
		    }

		    // if saved has otherItems, render them
		    var otherItems = (saved && saved.otherItems) ? saved.otherItems.slice() : [];
		    renderAdditional(otherItems);

				// wire Add Finance action (button in actions bar) and a global event
				var addFinanceBtn = document.getElementById('add-finance');
				function addFinanceItem() {
					otherItems.push({ label: 'New Item', value: 0 });
					renderAdditional(otherItems);
				}
				if (addFinanceBtn) {
					addFinanceBtn.addEventListener('click', addFinanceItem);
				}
				// global event so the central script can dispatch it
				document.addEventListener('add-finance-clicked', function(){ addFinanceItem(); });


		    form.addEventListener('submit', function(ev){
		      ev.preventDefault();
					var data = {
		        budget: document.getElementById('budget').value,
		        totalExpenses: document.getElementById('totalExpenses').value,
		        remaining: document.getElementById('remaining').value,
		        slice1Label: document.getElementById('slice1-label').value,
		        slice1Value: Number(document.getElementById('slice1-value').value) || 0,
		        slice2Label: document.getElementById('slice2-label').value,
		        slice2Value: Number(document.getElementById('slice2-value').value) || 0,
		        slice3Label: document.getElementById('slice3-label').value,
		        slice3Value: Number(document.getElementById('slice3-value').value) || 0,
		        coveredValue: Number(document.getElementById('covered-value').value) || 0,
		        coverageRemaining: Number(document.getElementById('coverage-remaining').value) || 0,
		        ftcTitle: document.getElementById('ftc-title').value,
		        ftcProgress: Number(document.getElementById('ftc-progress').value) || 0,
		        ftcDetails: document.getElementById('ftc-details').value,
		        donateContact: document.getElementById('donate-contact').value,
		        instagramUrl: document.getElementById('insta-link').value
		      };

					// collect additional finance items from DOM
					try {
						var rows = additionalRoot.querySelectorAll('.finance-item-row');
						var items = [];
						rows.forEach(function(r){
							var label = (r.querySelector('.fin-label')||{}).value || '';
							var value = Number((r.querySelector('.fin-value')||{}).value) || 0;
							items.push({ label: label, value: value });
						});
						data.otherItems = items;
					} catch(e) { data.otherItems = otherItems || []; }

		      // include ftc image data if user selected one
		      if (ftcPreview && ftcPreview.src && ftcPreview.src.indexOf('data:') === 0) data.ftcImageData = ftcPreview.src;

		      try { localStorage.setItem('finances_data', JSON.stringify(data)); alert('Finances saved locally. To apply changes to the live page, open finances.html (it reads from localStorage).'); }
		      catch (e) { console.error('Failed to save finances_data', e); alert('Save failed: localStorage not available'); }
		    });

		  })();
		</script>
		<footer>
			<p>&copy; 2025 Lindbergh Robotics</p>
			<p>Website by Kaden Cruts</p>
		</footer>
			<script src="script.js"></script>
			<script>
			  (function(){
			    var btn = document.getElementById('logout-btn');
			    if (!btn) return;
			    btn.addEventListener('click', function(){
			      try { sessionStorage.removeItem('lr_officerAuth'); } catch(e){}
			      window.location.href = 'officer.html';
			    });
			  })();
			</script>
		</body>
	</html>